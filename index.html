<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ›’ ç©ºç©ºå†°ç®± - æ™ºèƒ½å¨æˆ¿</title>
    <link href="https://fonts.googleapis.com/css2?family=ZCOOL+XiaoWei&family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --dark-green: #132a13;    /* æ·±ç»¿ï¼šæ–‡å­— */
            --forest: #31572c;         /* æ£®æ—ç»¿ï¼šé‡ç‚¹è‰² */
            --leaf: #90a955;           /* å¶å­ç»¿ï¼šæŒ‰é’®/é«˜äº® */
            --pale-leaf: #ecf39e;     /* æµ…è‰²ï¼šèƒŒæ™¯å¼ºè°ƒ */
            --bg-creme: #fffaf0;      /* å¥¶æ²¹è‰²ï¼šå…¨å±€èƒŒæ™¯ */
            --white-glass: rgba(255, 255, 255, 0.7); /* æ¯›ç»ç’ƒåº•è‰² */
        }

        body { 
            font-family: 'Noto Sans SC', sans-serif; 
            background-color: var(--bg-creme); 
            /* èƒŒæ™¯åŠ å…¥å¯çˆ±çš„å°è”¬æœå›¾æ ‡ */
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext x='10' y='30' font-size='24'%3EğŸ¥¦%3C/text%3E%3Ctext x='60' y='70' font-size='24'%3EğŸ¥•%3C/text%3E%3Ctext x='80' y='20' font-size='20' opacity='0.3'%3EğŸ‹%3C/text%3E%3C/svg%3E");
            margin: 0; display: flex; justify-content: center; min-height: 100vh;
            color: var(--dark-green);
        }

        .container { width: 92%; max-width: 450px; padding: 40px 10px; text-align: center; }

        /* æ ‡é¢˜æ ·å¼ï¼šä½¿ç”¨ç«™é…·å°è–‡ä½“ */
        h1 { 
            font-family: 'ZCOOL XiaoWei', serif; 
            font-size: 42px; 
            color: var(--dark-green); 
            margin-bottom: 5px;
            letter-spacing: 2px;
        }
        .subtitle { font-size: 14px; color: var(--forest); opacity: 0.8; margin-bottom: 30px; }

        /* è¾“å…¥æ¡†ç¾åŒ– */
        textarea { 
            width: 100%; padding: 22px; border: 3px solid var(--leaf); border-radius: 25px; 
            background: var(--white-glass); backdrop-filter: blur(10px);
            font-size: 16px; outline: none; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            box-sizing: border-box; color: var(--dark-green);
            box-shadow: 0 8px 0 var(--leaf); /* æ‹Ÿç‰©åŒ–é˜´å½± */
        }
        textarea:focus { transform: translateY(4px); box-shadow: 0 4px 0 var(--leaf); }

        .btn-group { margin-top: 30px; }
        
        /* æ‹Ÿç‰©åŒ–è¶£å‘³æŒ‰é’® */
        .btn-main { 
            background: var(--forest); color: #fff; border: none; padding: 18px; 
            border-radius: 50px; font-size: 18px; font-weight: bold; width: 100%;
            cursor: pointer; box-shadow: 0 8px 0 var(--dark-green);
            transition: all 0.1s; display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        /* ç‚¹å‡»ç¼©å°æ•ˆæœ */
        .btn-main:active { transform: translateY(6px); box-shadow: 0 2px 0 var(--dark-green); }
        .btn-main::before { content: 'ğŸ”¥'; }

        /* ç»“æœå¡ç‰‡ï¼šæ¯›ç»ç’ƒé£æ ¼ */
        #recipe-card { 
            display: none; margin-top: 40px; 
            background: var(--white-glass); 
            backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            border-radius: 35px; overflow: hidden; 
            box-shadow: 0 20px 40px rgba(19, 42, 19, 0.1); 
            animation: bounceIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            border: 2px solid rgba(255, 255, 255, 0.5);
        }

        @keyframes bounceIn { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }

        .recipe-img { width: 100%; height: 240px; object-fit: cover; }
        
        .recipe-content { padding: 25px; text-align: left; }
        .recipe-header { display: flex; justify-content: space-between; align-items: center; }
        .recipe-title { font-family: 'ZCOOL XiaoWei', serif; font-size: 26px; color: var(--forest); }
        
        .toggle-btn { 
            background: var(--pale-leaf); color: var(--forest); border-radius: 50%; 
            width: 40px; height: 40px; display: flex; align-items: center; 
            justify-content: center; cursor: pointer; transition: 0.3s;
        }

        #recipe-detail { 
            max-height: 0; overflow: hidden; transition: max-height 0.5s ease;
            font-size: 15px; line-height: 1.8; color: var(--dark-green);
        }
        #recipe-detail.show { max-height: 1000px; margin-top: 20px; }

        .retry-area { margin-top: 25px; text-align: center; }
        .btn-secondary { 
            background: transparent; color: var(--forest); 
            border: 2px dashed var(--forest); padding: 12px 25px;
            border-radius: 50px; font-size: 14px; cursor: pointer; transition: 0.3s;
        }
        .btn-secondary:hover { background: var(--pale-leaf); }

        .loading { display: none; margin-top: 30px; font-size: 18px; color: var(--forest); animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ›’ ç©ºç©ºå†°ç®±</h1>
        <div class="subtitle">è®©å‰©ä¸‹çš„é£Ÿæéƒ½è¿›ç›˜å­ âœ¨</div>
        
        <textarea id="ingredients" rows="3" placeholder="å†°ç®±é‡Œè¿˜æœ‰ä»€ä¹ˆï¼Ÿå¿«å‘Šè¯‰æˆ‘..."></textarea>
        
        <div class="btn-group">
            <button class="btn-main" onclick="startCooking()">å¼€å§‹åŠ å·¥ï¼</button>
        </div>

        <div id="loading" class="loading">ğŸ‘©â€ğŸ³ åˆ«å‚¬å•¦ï¼Œå¤§å¨åœ¨æƒ³äº†...</div>

        <div id="recipe-card">
            <img id="recipe-img" class="recipe-img" src="" alt="ç¾å‘³é¢„è§ˆ">
            <div class="recipe-content">
                <div class="recipe-header">
                    <span id="title-text" class="recipe-title"></span>
                    <div id="arrow" class="toggle-btn" onclick="toggleDetails()">â–¼</div>
                </div>
                
                <div id="recipe-detail">
                    <div id="steps-content"></div>
                    <div class="retry-area">
                        <button class="btn-secondary" onclick="generateAI()">ä¸æ»¡æ„ï¼Ÿæ¢ä¸ªå£å‘³ ğŸ”„</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const localRecipes = [
            { 
                name: "èŠ±æ¤’é¸¡è…¿", 
                keywords: ["èŠ±æ¤’", "é¸¡è…¿", "ç”Ÿå§œ"], 
                steps: "ã€ä¸»æ–™ã€‘é¸¡è…¿1ä¸ªã€èŠ±æ¤’ã€ç”Ÿå§œã€è‘±è‹¥å¹²\nã€æ­¥éª¤ã€‘\n1. å°†èŠ±æ¤’ã€ç”Ÿå§œã€è‘±ã€ç›æ´’åœ¨é¸¡è…¿ä¸Šï¼Œå……åˆ†æŒ‰æ‘©ã€‚\n2. æ”¾å…¥å†°ç®±å†·è—ä¸€å¤œè…Œåˆ¶ã€‚\n3. è’¸15-20åˆ†é’Ÿæˆ–çƒ¤ç®±180åº¦25åˆ†é’Ÿå³å¯ã€‚", 
                img: "/images/chicken-leg.jpg" 
            },
            { 
                name: "è›‹åŒ…éº»ç³", 
                keywords: ["é¸¡è›‹", "ç³ç²‘", "éº»ç³"], 
                steps: "ã€ä¸»æ–™ã€‘é¸¡è›‹2ä¸ªï¼Œéº»ç³1å—\nã€æ­¥éª¤ã€‘\n1. è›‹æ¶²åŠ è‘±èŠ±ç›æ‰“æ•£ã€‚\n2. é”…å†…å–·æ²¹ï¼Œæ”¾å…¥éº»ç³ç…è½¯ã€‚\n3. åˆ†ä¸¤æ¬¡è£¹ä¸Šè›‹æ¶²ï¼Œç…è‡³é‡‘é»„é…¥è„†å³å¯ã€‚", 
                img: "/images/glutinous-rice-egg.jpg" 
            }
        ];

        function startCooking() {
            const input = document.getElementById('ingredients').value.trim();
            if (!input) { alert("è¯·è¾“å…¥é£Ÿæå“¦ï¼"); return; }

            const found = localRecipes.find(recipe => 
                recipe.keywords.some(k => input.includes(k))
            );

            if (found) {
                showCard(found.name, found.steps, found.img);
            } else {
                generateAI();
            }
        }

        function showCard(title, steps, imgSrc) {
            const imgElement = document.getElementById('recipe-img');
            const detail = document.getElementById('recipe-detail');
            const arrow = document.getElementById('arrow');
            
            imgElement.src = imgSrc ? imgSrc : "/images/default-chef.jpg";
            
            document.getElementById('recipe-card').style.display = 'block';
            document.getElementById('title-text').innerText = title;
            document.getElementById('steps-content').innerText = steps;
            
            detail.classList.remove('show');
            arrow.innerText = "â–¼";

            document.getElementById('recipe-card').scrollIntoView({ behavior: 'smooth' });
        }

        function toggleDetails() {
            const detail = document.getElementById('recipe-detail');
            const arrow = document.getElementById('arrow');
            detail.classList.toggle('show');
            arrow.innerText = detail.classList.contains('show') ? "â–²" : "â–¼";
        }

        async function generateAI() {
            const input = document.getElementById('ingredients').value;
            const loading = document.getElementById('loading');
            loading.style.display = 'block';
            document.getElementById('recipe-card').style.display = 'none';

            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: "deepseek-chat",
                        messages: [
                            { role: "system", content: "ä½ æ˜¯ä¸€ä½ç²¾é€šâ€˜æ¸…å†°ç®±â€™çš„æš–å¿ƒå¤§å¨ã€‚è¿”å›æ ¼å¼ä¸¥æ ¼ä¸ºï¼šèœå: [åå­—] | åšæ³•: [æ­¥éª¤ï¼Œ1.2.3.åºå·åˆ†è¡Œ]" },
                            { role: "user", content: `æˆ‘æœ‰ï¼š${input}ã€‚è¯·ç»™å‡ºä¸€ä¸ªåˆ›æ„èœè°±ã€‚` }
                        ]
                    })
                });

                const data = await response.json();
                const content = data.choices[0].message.content;
                const [titlePart, stepsPart] = content.split('|');
                
                showCard(
                    titlePart.replace('èœå:', '').trim(), 
                    stepsPart.replace('åšæ³•:', '').trim(), 
                    null
                );
            } catch (error) {
                alert("å¤§å¨å¼€å°å·®äº†...");
            } finally {
                loading.style.display = 'none';
            }
        }
    </script>
</body>
</html>
